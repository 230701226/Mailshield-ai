import pandas as pd
from sklearn.feature_extraction.text import TfidfVectorizer
from sklearn.ensemble import IsolationForest
import joblib
import os

# ✅ Load dataset
df = pd.read_csv("data/known_emails.csv")
df['text'] = df['subject'] + " " + df['body']

# ✅ Use same vectorizer config (or load one)
vectorizer = TfidfVectorizer(stop_words='english', max_features=1000)
X = vectorizer.fit_transform(df['text'])

# ✅ Train Isolation Forest
model = IsolationForest(contamination=0.3, random_state=42)
model.fit(X)

# ✅ Ensure models/ directory exists
os.makedirs("models", exist_ok=True)

# ✅ Save model to models/
joblib.dump(model, "models/isolation_forest_model.pkl")

print("✅ Saved isolation_forest_model.pkl in models/")
